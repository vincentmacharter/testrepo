pipeline {
    agent any 
    stages {
	stage('Build'){
	    steps {
	    	echo 'Starting up eureka cluster...'
withKubeConfig(caCertificate: '''LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUV5RENDQXJDZ0F3SUJBZ0lSQU4ybUxGdlUwM2NxNEg2TU93MlhpM2N3RFFZSktvWklodmNOQVFFTEJRQXcKRFRFTE1Ba0dBMVVFQXhNQ1kyRXdIaGNOTVRnd05qRTBNVFV5TmpNMVdoY05NakF3TmpFek1UVXlOak0xV2pBTgpNUXN3Q1FZRFZRUURFd0pqWVRDQ0FpSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnSVBBRENDQWdvQ2dnSUJBTGFJCmU3RVgybVk1RVljbnp0QUt0RVJxTXB3cFl3TEFyRjJyK2pSd2NNUUdMRkhKZWE3ekZSYnJxSzFHWlphUnZOMFUKeW5PcGwwNno2aVFzRThsY0txd1VVZmpmVHdqR2RBOTdoSEcwWURoN2Z6OHRRUUkrYTF4ZGpXczVyaGdSYnhiNQpiZnNWc25JVUVjNkdMR1ROc1hIKzlTUUpvQ0dUN0NiSyt0QTdzWEZ1TDkwYXRvL3NzbEs3QWJRclJadjg5aGYyCnk0WjM3cmxnVmpzV21qYmZnZzVUbWRBWEpOUjJuQzQ2aFkyeTZVa0Z6bEVLNFE0NUpHMXpGd1A5ZXZiY0huVzcKQ3d5WHlaQ0poTDFYaFlXMTNGeTJzZGswMzJoUU9Eb1NYS2FSK2VNRGJuYndlc1FEMEtXRDB0LzJjSXNsdHJQYwpxV0o2a2d2VFdmbUZrZFRBbHh3RVdESzAxQXZPck5yUmkxMWY1Y1lvaS9rMlF6RXRBb1U0OTdJWnJwbjQ3aUVrClk1WWpDeTFwcmd6Sm5EZzFJeWpmc3NIdnBPNUF4all2TUtKbWFHV3RzN0tNVVdXS0UyWDY4ek5BS0g5M2NsOEoKTi9MQWM2Rm5XZ3hlcnd6c1crQ3h1bUowZjJNVWlGLzBkVmh1ZEluN0w0N2VSRFJYTGdpejI5eEhtVGdOVDhyQgpFaUpGdkp5L2ZZVitRZS9GdFdEZUdPOFR0UUtxajlZek1tZWpra21SVjR5TVNJL01EUDV0R3c2WEdBWEV1bjhLCkJGbmV5bkxSQjVWQmRJT0UwejRDOEZhMHM0RUF3OHlGQnBPUGlOdjIzRW9DUTVYa2dlYm5Xanh2YXc3VGFrbkUKeGxtdEI5MHBaY2lYbzM5UHNNeHBoN1NPaWhub2NwOVprOEdaWTVPZkFnTUJBQUdqSXpBaE1BNEdBMVVkRHdFQgovd1FFQXdJQ3BEQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQ0FRQW9MK0Z3CkQ4aGZ3eENPQUFsZ25vdVVCRDFPSE5GU1VHMnEvcXJwbno3ZGFtUklybE8zOGxKd2s4SzVyY0lJbHRrbHlxcFoKZmlHbC9NMHBBVndYZXRGcy9qVjcxYkRadEpNcFBGRlk5eEZmT0g1ZTVPZGNJdzZ1T08zVC9jTTdVd2dvbEkxTwpDd20wU1dYZmw2d1JZSVY1Wm16YkoxaE5SblEzVFFsK0dQSUpPVVdhZFFISU1kVEpRRVlHTVRWcHZZQlkvWXpyCjVybHhveldEM0pnakJVVFdSM1dEcXk1VjV6SzhVUktwaUtDU0YxT1VoNWFwc2hWa2VCRncwV3VEWktVY1J1aEcKOTUyNVFLamhzZWtJU2hOaGpFNFhUS2NudVFOQWZzdys5YmZYMU1EaWEvaGtidlBoUzlVTi9BY0xpUC9FV2tDNgpwNnhiWUNZRVNOaGQ1VDlvSzZpTXNiSDlOcktBeVp3Sy9KVm9oTUlJZzNMTjhiYUppQ1ovUG1kUHJIYWxNb1hkCjF4Q1NPYmxqak9kdHFoZEgrMW1QK0VIaHc1QndkWUlpUkc4WW1udlJKTDE2OEY2MDNqaWYzbkdpOEdpU3F6bysKdGpHcklOUVQvK25tb0RpelhvRjVFc3pYZk80R2F4UTdQS0FxOEpXTXB4Nk9UK0lzWDI3SGEvVW0zSTEvVjB6ZgpXSjBpNURYK2ZBV3lmcnpobStQczZHWGE1UXl3T0lOaERRdXVFWmc2SkFUNFpkaVIxNzdpU0k1Yjh3ZmhqMWdUCmlXZ3N3RXpsMk9lWUJwamtIT0NWT1F0dEJnaUhxUjcwTkdoUEZCU25lR3RsdFpNUmFST2lXa2d5QWJHSEE4V2EKbEJCd2p5YW0xcmtOcUwxYURycVBmVWZNSk8zSXdTcTVUdVdaSXc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
''', credentialsId: '', serverUrl: 'https://platform-test-eureka-ca213c38.hcp.eastus.azmk8s.io:443') 
			{
 
				sh 'kubectl get nodes'

			}
		
		}
	}

        stage('DNS Assignment') {
            steps {
                echo 'Testing Java App...'
                sh './update-public-ip-dns.sh eureka1 eurekatest-vincent eureka1svc'
                echo 'Assignment complete'
            }
        }
    }
}
